
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../lab/xv6lab-userspace/">
      
      
        <link rel="next" href="../xv6lab-baremetal/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Week 2 - C language basic & Makefile - 操作系统实验文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-language-basics-makefile" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="https://teecertlabs.com/" title="操作系统实验文档" class="md-header__button md-logo" aria-label="操作系统实验文档" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            操作系统实验文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Week 2 - C language basic & Makefile
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/yuk1i/os-next-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    os-next-docs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../env/" class="md-tabs__link">
          
  
  实验环境搭建

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../lab/lab1/" class="md-tabs__link">
          
  
  每周实验

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Weekly Lab Material

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../qrh/nav/" class="md-tabs__link">
          
  
  快速参考手册

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://teecertlabs.com/" title="操作系统实验文档" class="md-nav__button md-logo" aria-label="操作系统实验文档" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    操作系统实验文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yuk1i/os-next-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    os-next-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    实验环境搭建
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            实验环境搭建
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux VM 搭建
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Linux VM 搭建
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/vm/windows-vmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows + VMware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/vm/wsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows + WSL (不推荐)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/vm/macos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOS + VMware
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    手动环境配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode 远程配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/helloworld/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    验证环境
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    每周实验
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            每周实验
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/lab1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 1 - Linux基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/lab2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 2 - C 语言基础及Makefile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/xv6lab-baremetal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 3 - 裸机程序 Bare Metal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/xv6lab-interrupts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 4 - 陷入与中断 Trap & Interrupts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/xv6lab-contextswitch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 5 - 上下文切换 Context Switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/xv6lab-paging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 6 - 内核页表 Kernel Paging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab/xv6lab-userspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 7 - 用户空间 Userspace
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Weekly Lab Material
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Weekly Lab Material
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Week 2 - C language basic & Makefile
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Week 2 - C language basic & Makefile
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    <span class="md-ellipsis">
      Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointers" class="md-nav__link">
    <span class="md-ellipsis">
      Pointers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structs" class="md-nav__link">
    <span class="md-ellipsis">
      Structs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-system" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compilation System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observing-the-compilation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Observing the Compilation Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definition-and-declaration" class="md-nav__link">
    <span class="md-ellipsis">
      Definition and Declaration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-files" class="md-nav__link">
    <span class="md-ellipsis">
      Header Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readelf-to-read-the-symbol-table" class="md-nav__link">
    <span class="md-ellipsis">
      readelf to Read the Symbol Table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-and-makefile-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Make and Makefile Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Make and Makefile Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-structure-of-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure of Makefile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-makefile-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Makefile Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-clean" class="md-nav__link">
    <span class="md-ellipsis">
      make clean
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xv6lab-baremetal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 3 - Bare Metal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xv6lab-interrupts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week 4 - Trap & Interrupt
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    快速参考手册
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            快速参考手册
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qrh/nav/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    目录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qrh/vf2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VisionFive2 板子教程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qrh/ssh-vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH & VSCode 远程配置
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    <span class="md-ellipsis">
      Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointers" class="md-nav__link">
    <span class="md-ellipsis">
      Pointers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structs" class="md-nav__link">
    <span class="md-ellipsis">
      Structs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-system" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compilation System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observing-the-compilation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Observing the Compilation Process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definition-and-declaration" class="md-nav__link">
    <span class="md-ellipsis">
      Definition and Declaration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#header-files" class="md-nav__link">
    <span class="md-ellipsis">
      Header Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readelf-to-read-the-symbol-table" class="md-nav__link">
    <span class="md-ellipsis">
      readelf to Read the Symbol Table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-and-makefile-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Make and Makefile Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Make and Makefile Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-structure-of-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure of Makefile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-makefile-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Makefile Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-clean" class="md-nav__link">
    <span class="md-ellipsis">
      make clean
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="c-language-basics-makefile">C Language Basics &amp; Makefile<a class="headerlink" href="#c-language-basics-makefile" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">C Language Basics</p>
<p>If you haven't learned C, we <strong>strongly recommend</strong> that you watch Teacher Yu's C/C++ course in advance: <a href="https://www.bilibili.com/video/BV1Vf4y1P7pq">https://www.bilibili.com/video/BV1Vf4y1P7pq</a>. Watching up to Chapter 6.5 will help you understand the basic syntax of C.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">RISC-V Assembly</p>
<p>We expect that you have completed the "Computer Organization" course and understand the basics of RISC-V assembly.</p>
<p>Additionally, always keep "The RISC-V Instruction Set Manual, Volume I: User-Level ISA, Version 2.1" (riscv-spec-v2.1.pdf) and "The RISC-V Instruction Set Manual, Volume II: Privileged Architecture, Document Version 20211203" (riscv-privileged-20211203.pdf) as reference manuals for RISC-V assembly.</p>
</div>
<h2 id="types">Types<a class="headerlink" href="#types" title="Permanent link">&para;</a></h2>
<p>In C, integer types include long, int, short, char, etc.
In most cases, the int type is 32 bits long, while the length of the long type depends on the ABI (Application Binary Interface, specified by the user during compilation).
To avoid inconsistencies in the actual length of long, int, etc., due to differences in compilation target architectures, we use fixed-length integer types such as uint64_t, int32_t, etc., in system programming.
In different ABI/compiler environments, using these types ensures they are of the specified length.</p>
<p>For example, in <code>os/types.h</code>:</p>
<div class="highlight"><span class="filename">os/types.h</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uint</span><span class="p">;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ushort</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">uchar</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">uint8</span><span class="p">;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">uint16</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uint32</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">uint64</span><span class="p">;</span>
</code></pre></div>
<p>We define <code>uint64</code>, <code>uint32</code>, etc., as <code>unsigned long</code> and <code>unsigned int</code>, respectively.
Since we are programming for the riscv64 architecture, we can ensure that in our XV6, they are 64/32 bits.</p>
<div class="admonition warning">
<p class="admonition-title">unsigned</p>
<p>Note that in C, the default type for integer literals within the range of the int type is int.</p>
<p>When an unsigned int is compared with a signed integer (e.g., int), the signed integer is promoted to unsigned int. If the constant is negative, it may become a very large unsigned value after promotion, leading to unexpected comparison results.</p>
<p>Try executing the following code and observe the result:</p>
<p><img alt="image" src="https://github.com/user-attachments/assets/7abc8a00-e968-424e-93be-d489d28392c4" /></p>
</div>
<h3 id="pointers">Pointers<a class="headerlink" href="#pointers" title="Permanent link">&para;</a></h3>
<p>A pointer is a variable type in programming languages that stores the memory address of another variable. Through pointers, you can indirectly access and manipulate the values of other variables. Pointers are commonly used in dynamic memory allocation, function parameter passing, and the implementation of data structures (e.g., linked lists, trees, etc.).</p>
<ol>
<li>
<p>Pointer "content": It stores a memory address, not the data value directly. For example, pointer p can store the memory address of variable x, not the value of x.</p>
</li>
<li>
<p>Pointer type: A pointer has a type, indicating the type of variable it points to. For example, <code>int* p</code> means p is a pointer to an int.</p>
</li>
<li>
<p>Dereferencing: The process of accessing the variable a pointer points via the pointer to is called dereferencing. In C, you can dereference a pointer using the * operator to get the value it points to.</p>
</li>
<li>
<p>Address-of: All variables stored in memory can have their addresses taken. We use <code>&amp;</code> to denote taking the address of a variable.</p>
</li>
</ol>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">     </span><span class="c1">// Define a variable a, initialized to 10.</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">    </span><span class="c1">// Take the memory address of variable a and store it in pointer p.</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">        </span><span class="c1">// Modify the memory address pointed to by p to 20.</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kt">int</span><span class="w"> </span><span class="o">**</span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">;</span><span class="w">  </span><span class="c1">// Take the address of variable p and store it in pointer pp.</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="o">*</span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">;</span><span class="w">       </span><span class="c1">// Change the content of pointer p (the address it points to) to the address of variable b.</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="o">**</span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w">      </span><span class="c1">// Double dereference.</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a: %d, b:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">  </span><span class="c1">// Output: a:20, b:50.</span>
</code></pre></div>
<p>A diagram to understand pointers:</p>
<p><img alt="alt text" src="../../assets/lab2/pointer.jpeg" /></p>
<h3 id="structs">Structs<a class="headerlink" href="#structs" title="Permanent link">&para;</a></h3>
<p>We use the <code>struct</code> keyword to indicate that the type is a struct. <strong>A struct is a collection of data packed together</strong>.</p>
<p>For example, we declare a struct <code>struct proc</code> with the following fields:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">proc</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">chan</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">uint64</span><span class="w"> </span><span class="n">krkr</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">uint8</span><span class="w"> </span><span class="n">dkdk</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">};</span>
</code></pre></div>
<p>We use the <code>.</code> operator to access a field of a struct variable and the <code>-&gt;</code> operator to dereference a field of a struct pointer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">proc</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">p1</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1234</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">proc</span><span class="w"> </span><span class="o">*</span><span class="n">pProc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">pProc</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proc 1234&quot;</span><span class="p">;</span>
</code></pre></div>
<h2 id="compilation-system">Compilation System<a class="headerlink" href="#compilation-system" title="Permanent link">&para;</a></h2>
<p>In the "Computer Organization" course, we briefly introduced the compilation system of C. Typically, compiling a program involves the following steps:</p>
<p><img alt="image" src="../../assets/lab1/lab1-compilation-system.png" /></p>
<ol>
<li>The source code .c file is preprocessed by the Pre-processor cpp to generate the .i file.</li>
</ol>
<p>The .i file is an intermediate file generated during the preprocessing stage of GCC, containing expanded header files, macro definitions, and conditionally compiled code. Use <code>gcc -E</code> to generate the .i file.</p>
<ol>
<li>The .i file is compiled by the cc1 compiler to generate the assembly file .s.</li>
</ol>
<p>The compiler performs syntax checking on the .i file. If no errors are found, it converts the .i file into assembly code (human-readable machine code). During this process, the optimizer can optimize the code.</p>
<ol>
<li>The .s file is assembled by the assembler as to generate the Relocatable objects (relocatable file) .o.</li>
</ol>
<p>During this process, the assembler converts assembly code into object code (machine code—code that can be directly executed by the machine, not human-readable).</p>
<ol>
<li>The linker ld links all .o files to generate the final executable.</li>
</ol>
<p>On Linux systems, object files and executables are typically stored in the <strong>ELF (Executable and Linkable Format)</strong> file format.
   ELF files are divided into different <strong>sections</strong>, which store specific types of data, such as code (.text), data (.data), and the symbol table (.symtab). Each section has its specific purpose and attributes.</p>
<p>Typically, we use "compiler" to refer to all the tools used in the compilation and linking process, even though the compiler and linker are two different programs. Specifically, when discussing the compiler and linker, we collectively refer to the tools that perform preprocessing, assembly, and compilation as the compiler; the tool used in the final linking step is called the linker.</p>
<h3 style="color: orange;">Experiment Step 1: Observing the C Compilation Process</h3>

<p>Below is a simple C code example suitable for observing the <code>.i</code>, <code>.s</code>, and <code>.o</code> files during the GCC compilation process:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// main.c</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Sum: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="p">}</span>
</code></pre></div>
<h4 id="observing-the-compilation-process">Observing the Compilation Process<a class="headerlink" href="#observing-the-compilation-process" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Preprocessing</strong>: Generate the <code>.i</code> file
   <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>gcc<span class="w"> </span>-E<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main.i
</code></pre></div>
   This generates the <code>main.i</code> file, which contains the preprocessed code (macro expansion, header file inclusion, etc.). You can view its contents using <code>cat main.i</code>.</p>
</li>
<li>
<p><strong>Compilation</strong>: Generate the <code>.s</code> file
   <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>gcc<span class="w"> </span>-S<span class="w"> </span>main.i<span class="w"> </span>-o<span class="w"> </span>main.s
</code></pre></div>
   This generates the <code>main.s</code> file, which contains the assembly code. You can view its contents using <code>cat main.s</code>.</p>
</li>
<li>
<p><strong>Assembly</strong>: Generate the <code>.o</code> file
   <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>gcc<span class="w"> </span>-c<span class="w"> </span>main.s<span class="w"> </span>-o<span class="w"> </span>main.o
</code></pre></div>
   This generates the <code>main.o</code> file, which contains the object code (machine code). You can analyze the contents of <code>main.o</code> using the <code>objdump</code> tool. For example, use <code>objdump -d hello.o</code> to view the machine code and its corresponding assembly instructions.</p>
</li>
<li>
<p><strong>Linking</strong>: Generate the executable
   <div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>gcc<span class="w"> </span>main.o<span class="w"> </span>-o<span class="w"> </span>main
</code></pre></div>
   This generates the executable <code>main</code>. You can check the file type of <code>main</code> using <code>file main</code>, which should be ELF. You can use the <code>readelf</code> tool from the GNU Binutils toolset to view the ELF file's header, section information, symbol table, dynamic section information, etc. For example, use <code>readelf -h main</code> to view the file header of <code>main</code>.</p>
</li>
</ol>
<h2 id="definition-and-declaration">Definition and Declaration<a class="headerlink" href="#definition-and-declaration" title="Permanent link">&para;</a></h2>
<p>Definition and Declaration are two concepts in C that are easily confused.</p>
<p>Declaration declares a symbol (variable, function, etc.) and some basic information about it (e.g., variable type, function parameter types, function return type). This allows the compiler to use this type information for code generation <strong>during the compilation phase</strong>.</p>
<p>Definition, on the other hand, actually allocates a memory address for the symbol. The linker <strong>during the linking phase</strong> assigns addresses to these symbols (e.g., function addresses, global variable addresses).</p>
<div class="admonition info">
<p class="admonition-title">Symbol</p>
<p>In C, a symbol is a name used by the compiler to represent various entities in a program (e.g., variables, functions, macros, type names, etc.). Each symbol is associated with a specific memory address or other resource during compilation. When a program is compiled, the compiler creates a symbol table (Symbol Table) to record the names, types, scopes, and corresponding memory addresses or values of these symbols.</p>
<p>In short, a symbol is a name representing an entity in a program, and the compiler manages and resolves these names through the symbol table.</p>
<p>When the compiler compiles a <code>.c</code> file, it processes the source code line by line and maintains a symbol table representing all symbols seen so far in the current file. When the compiler encounters a reference to a symbol (variable reference, function call), it looks up this symbol table; when the compiler encounters a declaration or definition of a symbol, it saves information about this symbol in the symbol table.</p>
<p>Therefore, we must ensure that when referencing a symbol, it has at least been declared, i.e., seen by the compiler. At the same time, in the same file, a definition is also a declaration.</p>
</div>
<p>For the compiler, if a <code>.c</code> file needs to reference functions or variables from other <code>.c</code> files, it must <strong>declare</strong> them in advance. When the compiler encounters a symbol that has been declared but not defined in the current file (e.g., printf), the compiler assumes that the symbol will be defined in other object files, leaves some information, and lets the linker find the symbol during the linking phase.</p>
<p>For example, <code>a.c</code> <strong>defines</strong> the variable <code>int a</code>. If <code>main.c</code> wants to reference it, it needs to <strong>declare</strong> it using <code>extern int a</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">// a.c</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1">// main.c</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">}</span>
</code></pre></div>
<p>During compilation, we first compile <code>a.c</code> and <code>main.c</code> into <code>a.o</code> and <code>main.o</code>, respectively: <code>gcc -c a.c -o a.o</code>, <code>gcc -c main.c -o a.o</code>, then link the two .o files: <code>gcc main.o a.o</code> to generate the executable a.out.</p>
<p>When compiling <code>a.c</code>, the compiler-generated <code>a.o</code> indicates that it has a globally visible symbol named <code>a</code>.
When compiling <code>main.c</code>, the compiler does not know anything about other .c files. However, we declared the variable <code>a</code> in the first line, so it knows that there will be a symbol named <code>a</code> during linking. The compiler-generated <code>main.o</code> indicates that it needs a symbol named <code>a</code>.</p>
<p>The linker will search the symbol tables of all <code>.o</code> files and match symbols based on names and visibility.</p>
<p>To organize large projects, we do not manually import symbols from other <code>.c</code> files in each <code>.c</code> file. Instead, we use header files to declare these shared symbols.</p>
<h2 id="header-files">Header Files<a class="headerlink" href="#header-files" title="Permanent link">&para;</a></h2>
<p>The purpose of a header file (Header File) is to declare functions, variables, macro definitions, constants, types, etc., <strong>to be shared across multiple source files</strong>. We use the <code>#include</code> macro at the beginning of <code>.c</code> files to import header files. Its semantics is to directly copy the file content into the current file, a step performed by the preprocessor.</p>
<p>If a <code>.c</code> file has types, functions, or variables that need to be referenced by other <code>.c</code> files, we create a corresponding header file. When naming header files, we generally use the same filename but with a <code>.h</code> suffix; for example, for shared information in <code>a.c</code>, we create its header file <code>a.h</code>.</p>
<p>For shared functions and variables, we typically <strong>declare</strong> them in <code>a.h</code> and <strong>define</strong> them in <code>a.c</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// a.h</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1">// a.c</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1">// or int a = 10;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="p">}</span>
</code></pre></div>
<p>If <code>main.c</code> needs to reference the <code>a</code> variable or <code>add</code> function provided by <code>a.c</code>, it can include the <code>a.h</code> header file at the beginning:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// main.c</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;a.h&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">666</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>
<p>A global variable declared and defined in a <code>.c</code> file cannot be <strong>directly</strong> used by other <code>.c</code> files. For example, if you have <code>int a;</code> in one <code>.c</code> file, you need <code>extern int a;</code> in another file for the two files to share the same <code>a</code>.</p>
</li>
<li>
<p>When defining global variables in multiple <code>.c</code> files, we must ensure the variable names are unique. Otherwise, it will lead to multiple definitions.</p>
</li>
<li>
<p>If we want to define global variables visible only to the current <code>.c</code> file, we can use the <code>static</code> keyword.</p>
</li>
<li>
<p>Header files can only declare variables. If a header file defines a variable and more than one <code>.c</code> file includes this header file, it will also result in multiple definitions because the preprocessor directly copies the included content into the current file, causing both <code>.c</code> files to define the variable.</p>
</li>
<li>
<p>If you want a variable to be shared across multiple <code>.c</code> files, you can declare the variable in the header file using the <code>extern</code> keyword and define it in any one <code>.c</code> file.</p>
</li>
</ul>
</div>
<h2 id="readelf-to-read-the-symbol-table">readelf to Read the Symbol Table<a class="headerlink" href="#readelf-to-read-the-symbol-table" title="Permanent link">&para;</a></h2>
<p>Let's explain the difference between Declaration and Definition again:</p>
<ul>
<li>
<p>Definition tells the linker that this .o file contains a symbol, and the linker needs to allocate a memory address for it. If other .o files need to reference this symbol, it must check whether the symbol allows external access, i.e., whether <code>static</code> was used during declaration.</p>
</li>
<li>
<p>Declaration assures the compiler that the symbol will be found during linking, whether it is defined in the current <code>.c</code> file or other <code>.c</code> files. The compiler only needs to generate code based on the declared variable type or function prototype (e.g., the width of variable access (lb, lw, ld), the number of function parameters), and the linker is responsible for finding these symbols.</p>
</li>
</ul>
<p>We can use <code>llvm-readelf-19 --symbol &lt;file&gt;</code> to view the symbol table of an ELF file. The meaning of the fields can be referenced at <a href="https://docs.oracle.com/cd/E19455-01/816-0559/chapter6-79797/index.html">https://docs.oracle.com/cd/E19455-01/816-0559/chapter6-79797/index.html</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>$ llvm-readelf-19 --symbols build/os/proc.o | grep -E &quot;FUNC|OBJECT|GLOBAL&quot;
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Symbol table &#39;.symtab&#39; contains 1240 entries:
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>   Num:    Value          Size Type    Bind   Vis       Ndx Name
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>     5: 0000000000000000    72 FUNC    LOCAL  DEFAULT     1 curr_proc
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    23: 0000000000000048   304 FUNC    LOCAL  DEFAULT     1 freeproc
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    97: 0000000000000178    92 FUNC    LOCAL  DEFAULT     1 first_sched_ret
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>   128: 0000000000000000     4 OBJECT  LOCAL  DEFAULT     6 proc_inited.1
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>   237: 0000000000000000     4 OBJECT  LOCAL  DEFAULT     7 PID.0
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>   663: 0000000000000000    32 OBJECT  LOCAL  DEFAULT     4 pid_lock
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>   664: 0000000000000020    32 OBJECT  LOCAL  DEFAULT     4 wait_lock
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>   665: 0000000000000040   104 OBJECT  LOCAL  DEFAULT     4 proc_allocator
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>  1201: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND push_off
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>  1202: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND mycpu
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>  1203: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND pop_off
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>  1210: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND usertrapret
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>  1211: 00000000000001d4   544 FUNC    GLOBAL DEFAULT     1 proc_init
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>  1212: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND spinlock_init
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>  1213: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND allocator_init
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>  1214: 00000000000000a8  4096 OBJECT  GLOBAL DEFAULT     4 pool
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>  1215: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND kernel_pagetable
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>  1216: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND kallocpage
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>  1217: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND kalloc
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>  1218: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND memset
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>  1219: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT   UND kvmmap
</code></pre></div>
<p>The Type column indicates whether the symbol is a function (FUNC) or a variable (OBJECT). Bind indicates whether the symbol allows other .o files to find it (LOCAL/GLOBAL). Ndx indicates whether the symbol is defined in this .o file. <code>UND</code> means it is an external <code>.o</code>, i.e., a symbol that needs to be imported from other .o files, so its Type and Size are unknown.</p>
<p>Now, do you understand the reasons for the two common linking errors: multiple definition and undefined reference?</p>
<ul>
<li><code>riscv64-unknown-elf-ld: build/os/proc.o:os/proc.c:14: multiple definition of 'idle'; build/os/main.o:os/main.c:7: first defined here</code><ul>
<li>The <code>idle</code> variable was defined multiple times in different .c files.</li>
</ul>
</li>
<li><code>riscv64-unknown-elf-ld: build/os/proc.o: in function 'proc_init': os/proc.c:38:(.text+0xd0): undefined reference to 'idle'</code><ul>
<li>The <code>idle</code> variable was declared in the header file but not defined.</li>
</ul>
</li>
</ul>
<h2 id="make-and-makefile-introduction">Make and Makefile Introduction<a class="headerlink" href="#make-and-makefile-introduction" title="Permanent link">&para;</a></h2>
<p>Consider a scenario where our project is slightly larger (e.g., containing multiple C files). Every time we run it, we have to execute many gcc commands. Is there a compilation tool that can simplify this process? Next, we introduce the automated build tool, make.</p>
<p><code>Makefile</code> is a configuration file used for automating the build process (compilation, linking, etc.) of programs, typically used to manage projects with multiple source files. It defines how to generate target files (e.g., executables, library files) from source code and ensures that only the parts that need updating are recompiled, improving build efficiency.</p>
<p><code>Makefile</code> is the input file for the <code>make</code> tool, a classic build tool widely used in Unix/Linux systems.</p>
<h3 style="color: orange;">Experiment Step 2: Using Makefile for Automated Build</h3>

<p>First, we create three files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">//print.h header file</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1">//print.c</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;print.h&quot;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(){</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="p">}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="c1">//main.c</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;print.h&quot;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">    </span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">}</span>
</code></pre></div>
<p>Due to the dependencies in the files, if we want to run the above code, we need to generate .o object files for each .c file and then link the two .o files to generate the executable:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>gcc<span class="w"> </span>-c<span class="w"> </span>main.c
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>gcc<span class="w"> </span>-c<span class="w"> </span>print.c
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>gcc<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>main.o<span class="w"> </span>print.o
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>./main
</code></pre></div>
<p><img alt="image-20220212090901375" src="https://github.com/user-attachments/assets/44cc95f1-6eb4-41d4-9c01-0d6dd8f13b64" /></p>
<p><img alt="image-20220212090954211" src="https://github.com/user-attachments/assets/99779e00-ce5e-4421-9c1b-2fdbb022beec" /></p>
<p>As you can see, if we have many files, running the program becomes very complex. To make the compilation process easier, we can use a Makefile.</p>
<p>Next, we create a text file named Makefile.</p>
<p>Makefile content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nf">main </span><span class="o">:</span><span class="w"> </span><span class="n">main</span>.<span class="n">o</span> <span class="n">print</span>.<span class="n">o</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span>gcc<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>main.o<span class="w"> </span>print.o
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nf">main.o </span><span class="o">:</span><span class="w"> </span><span class="n">main</span>.<span class="n">c</span> <span class="n">print</span>.<span class="n">h</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span>gcc<span class="w"> </span>-c<span class="w"> </span>main.c
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="nf">print.o </span><span class="o">:</span><span class="w"> </span><span class="n">print</span>.<span class="n">c</span> <span class="n">print</span>.<span class="n">h</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span>gcc<span class="w"> </span>-c<span class="w"> </span>print.c
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="nf">clean</span><span class="o">:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span>rm<span class="w"> </span>main<span class="w"> </span>main.o<span class="w"> </span>print.o
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Makefile, indentation must be done with tabs, not spaces; otherwise, it will not execute properly.</p>
</div>
<p>Finally, we only need to execute the <code>make</code> command to complete the entire compilation process:</p>
<p><img alt="image-20220212091943782" src="https://github.com/user-attachments/assets/5cedda77-c3d2-4b68-a053-b2d00da58a52" /></p>
<h3 id="basic-structure-of-makefile">Basic Structure of Makefile<a class="headerlink" href="#basic-structure-of-makefile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nf">target</span><span class="o">:</span><span class="w"> </span><span class="n">dependencies</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="err">[tab]</span><span class="w"> </span><span class="err">system</span><span class="w"> </span><span class="err">command</span>
</code></pre></div>
<h3 id="how-makefile-works">How Makefile Works<a class="headerlink" href="#how-makefile-works" title="Permanent link">&para;</a></h3>
<p>By default, when we only enter the <code>make</code> command:</p>
<ol>
<li>make looks for a file named "Makefile" or "makefile" in the current directory.</li>
<li>If found, it looks for the first target file (target) in the file. In the example above, it finds the "main" file and uses it as the final target file.</li>
<li>If the main file does not exist, or if the modification time of the <code>.o</code> files it depends on is newer than the <code>main</code> file, it executes the commands defined later to generate the <code>main</code> file.</li>
<li>If the <code>.o</code> files that <code>main</code> depends on do not exist, make looks for the dependencies of the <code>.o</code> files in the current file. If found, it generates the <code>.o</code> files according to that rule. (like a stack process)</li>
<li>Obviously, your C and Header files exist, so make generates the <code>.o</code> files and then uses them to generate make's ultimate task, the executable <code>main</code>.</li>
</ol>
<h3 id="make-clean">make clean<a class="headerlink" href="#make-clean" title="Permanent link">&para;</a></h3>
<p>From the above analysis, we know that commands like clean, which are not directly or indirectly associated with the first target file, will not be executed automatically. However, we can explicitly ask make to execute them. For example, the command <code>make clean</code> clears all object files for recompilation.</p>
<p>For more information about Makefile, refer to: <a href="https://seisman.github.io/how-to-write-makefile/introduction.html">How to Write Makefile 1.0 Documentation</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-copyright">
    <div class="md-copyright__highlight">
        commit: 
        <a href="https://github.com/yuk1i/os-next-docs/commit/a1c70fdf, 2025-03-16 16:44:47+08:00" target="_blank" rel="noopener">
            a1c70fdf, 2025-03-16 16:44:47+08:00
        </a>
    </div>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>